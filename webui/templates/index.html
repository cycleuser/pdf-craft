<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基于光学字符识别和本地大语言模型的文档转换平台</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>基于光学字符识别和本地大语言模型的文档转换平台</h1>
            <p>上传PDF文件，自动转换为Markdown格式</p>
        </header>

        <div class="settings-panel">
            <div class="device-toggle">
                <span>处理设备:</span>
                <div class="toggle-switch">
                    <input type="checkbox" id="gpu-toggle" {% if use_gpu %}checked{% endif %} title="切换GPU/CPU处理模式">
                    <label for="gpu-toggle" title="切换GPU/CPU处理模式"></label>
                </div>
                <span id="device-label">{% if use_gpu %}GPU{% else %}CPU{% endif %}</span>
            </div>

            <div class="batch-size-control">
                <span>批处理大小:</span>
                <input type="number" id="batch-size" min="1" max="10" value="5" title="设置同时处理的PDF文件数量">
                <button id="update-batch-size">更新</button>
            </div>

            <button id="show-system-info" class="info-button">
                <i class="fas fa-info-circle"></i> 系统信息
            </button>
        </div>

        <div class="model-config-panel">
            <h2>模型配置 <button id="toggle-config-panel" class="toggle-button">显示/隐藏</button></h2>
            <div id="config-panel" style="display: none;">
                <div class="config-options">
                    <div class="config-option">
                        <label for="ocr-level">OCR级别:</label>
                        <select id="ocr-level">
                            {% for key, level in ocr_levels.items() %}
                            <option value="{{ key }}" {% if current_config.ocr_level == key %}selected{% endif %}>{{ level.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="option-description">
                            <span id="ocr-level-description">
                                {{ ocr_levels[current_config.ocr_level].description }}
                            </span>
                        </div>
                    </div>

                    <div class="config-option">
                        <label for="table-format">表格提取:</label>
                        <select id="table-format">
                            {% for key, format in table_formats.items() %}
                            <option value="{{ key }}" {% if current_config.extract_table_format == key %}selected{% endif %}>{{ format.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="option-description">
                            <span id="table-format-description">
                                {{ table_formats[current_config.extract_table_format].description }}
                            </span>
                        </div>
                    </div>

                    <div class="config-option">
                        <label for="extract-formula">提取公式:</label>
                        <input type="checkbox" id="extract-formula" {% if current_config.extract_formula %}checked{% endif %}>
                        <div class="option-description">
                            <span>启用数学公式提取功能（可能会增加处理时间）</span>
                        </div>
                    </div>

                    <div class="config-option">
                        <label for="ollama-model">Ollama模型:</label>
                        <select id="ollama-model" {% if not ollama_available %}disabled{% endif %}>
                            {% for key, model in ollama_models.items() %}
                            <option value="{{ key }}" {% if current_config.ollama_model == key %}selected{% endif %}>{{ model.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="option-description">
                            {% if ollama_available %}
                            <span id="ollama-model-description">
                                {{ ollama_models[current_config.ollama_model].description }}
                            </span>
                            {% else %}
                            <span class="warning-text">Ollama服务未检测到，无法使用本地LLM</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="config-buttons">
                    <button id="save-config" class="primary-button">保存配置</button>
                    <button id="reset-config" class="secondary-button">重置为默认</button>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-container">
                <div id="drop-area">
                    <form class="upload-form">
                        <input type="file" id="fileInput" multiple accept=".pdf" hidden>
                        <label for="fileInput" class="file-label">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>点击或拖放PDF文件到此处</span>
                        </label>

                        <div class="upload-options">
                            <div class="option-item">
                                <input type="checkbox" id="use-custom-config">
                                <label for="use-custom-config">为此上传使用自定义配置</label>
                            </div>
                        </div>

                        <button type="button" id="uploadButton" class="upload-button">开始上传</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="jobs-section">
            <h2>处理队列</h2>
            <div class="jobs-container">
                <button id="clear-jobs" class="clear-button" title="清空所有任务和相关文件">清空所有任务</button>
                <table id="jobsTable">
                    <thead>
                        <tr>
                            <th>文件名</th>
                            <th>状态</th>
                            <th>进度</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="jobsTableBody">
                        <!-- Jobs will be listed here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="systemInfoModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>系统信息</h2>
                <div id="systemInfoContent">
                    <!-- System info will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>